version: 2

sources:
  - name: franchise_script
    description: >
      Bronze schema with franchise raw tables loaded from Snowflake internal stage.
      Single source system; each staging model is 1:1 with these tables.
    database: "{{ env_var('DBT_ENVIRONMENTS') }}_BRONZE_DB"
    schema: franchise_script
    loader: "internal_stage_copy"

    tables:
      - name: ZONES
        description: "Population, geography and socio-economic attributes by zone (now including region and country names)."
        columns:
          - name: zone_id
            description: "Zone natural key (1..N)."
            tests: [not_null, unique]

          - name: zone_name
            description: "Human-readable zone name (e.g. 'Costa', 'Serranía')."
            tests: [not_null]

          - name: region_name
            description: "Region associated to the zone (e.g. 'Comunidad Valenciana')."
            tests: [not_null]

          - name: country_name
            description: "Country associated to the zone (e.g. 'Spain')."
            tests: [not_null]

          - name: lat
            description: "Zone centroid latitude."
          - name: lon
            description: "Zone centroid longitude."
          - name: population
            description: "Estimated population in the zone."
          - name: income_index
            description: "Relative income index for the zone."
          - name: unemployment_rate
            description: "Unemployment rate (0–100, no % sign)."

      - name: STORES
        description: "Store master data: format, capacity, opening hours, location."
        columns:
          - name: store_id
            tests: [not_null, unique]
          - name: zone_id
            tests: [not_null]

      - name: STORE_GATES
        description: "Store entrances/exits inventory with direction and technology."
        columns:
          - name: store_id
            tests: [not_null]
          - name: gate_id
            tests: [not_null]

      - name: ZONE_WEATHER_DAYS
        description: "Daily weather by zone."
        loaded_at_field: day

      - name: POS_STORE_DAYS
        description: "Daily POS totals by store."
        loaded_at_field: day

      - name: ENTRIES_5M
        description: "5-minute gate entries/exits."
        loaded_at_field: window_5m

      - name: IOT_PRESENCE_5M
        description: "5-minute device presence (people density proxy)."
        loaded_at_field: ts

      - name: QUEUES_5M
        description: "5-minute queue KPIs per store."
        loaded_at_field: window_5m

      - name: POS_TICKETS
        description: "Ticket-level POS data with open/close timestamps."
        loaded_at_field: closed_at

      - name: MOBILITY_OD_15M
        description: "15-minute arrivals from origin zone to destination store."
        loaded_at_field: ts

      - name: STAFF_SHIFTS
        description: "Staff shifts per store/day."

      - name: INVENTORY_DAYS
        description: "Daily inventory & movements per store/product."
        loaded_at_field: day
